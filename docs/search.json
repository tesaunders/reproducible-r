[
  {
    "objectID": "02_code.html",
    "href": "02_code.html",
    "title": "R Code",
    "section": "",
    "text": "We can improve our scripts by writing code which is:\n\nReadable\n\n\nUse a consistent style guide (like the tidyverse one)\nBe clear, concise, and consistent when naming objects, datasets, and functions\nBreak your scripts up into sections (Ctrl+Shift+R)\n\n\nReusable\n\n\nWrite functions to perform sets of operations\nUse iteration (for loops, or map())\nConsider creating packages for data and code used in multiple places\nBreak up long scripts into separate files (cleaning, manipulating, plotting)\n\n\nDocumented\n\n\nUse comments to explain why you did something the way you did\nInclude a README with each project to provide important context and background\n\nCreate a new script in RStudio (Ctrl+Shift+N) and save it in the scripts folder.\nLoad packages we need for the workshop.\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(purrr)\nlibrary(renv)\n\nLet’s take a common example of some data analysis and apply the above principles when writing the code.\nFirst, let’s read in some data split into different files by month. Instead of naming each file, we can use readr::read_csv() to read them all in at once, bind them together into a single dataframe, and add a new column containing the filename of the data source.\n\nfiles &lt;- list.files(path = \"data_raw\", pattern = \"\\\\.csv\", full.names = TRUE)\n\nsurveys &lt;- read_csv(files, id = \"source\")\n\nThis dataset comprises measurements taken from mammals captured in the Chihuahuan desert.\nLet’s say we wanted to create a separate scatterplot for each species showing hindfoot length vs weight. Even if we’re only interested in species codes with at least 100 valid observations, that’s still 11 plots.\n\nvalid_species &lt;-\n  surveys |&gt;\n  drop_na(all_of(c(\"weight\", \"hindfoot_length\"))) |&gt; \n  count(species_id) |&gt; \n  filter(n &gt;= 100) |&gt; \n  pull(species_id)\n\nRather than write out the same code 15 times, this is a good time to write our own function. If we encapsulate all the plotting steps in a function, we can then use {purrr} to apply the function over the species and create the plots.\n\n# Create an example of a plot\nggplot(surveys, aes(x = weight, y = hindfoot_length, colour = sex)) +\n  geom_point() +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nplot_species &lt;- function(data, x_var, y_var, colour, species) {\n\n  filtered_data &lt;- \n    data |&gt; \n    filter(species_id == {{ species }})\n  \n  plot_title &lt;- paste0(y_var, \" vs. \", x_var, \" for Species ID: \", species)\n  \n  plot &lt;- \n    filtered_data |&gt; \n    ggplot(aes(x = .data[[x_var]], y = .data[[y_var]], colour = .data[[colour]])) +\n    geom_point(alpha = 0.6) +\n    theme_minimal() +\n    ggtitle(plot_title)\n  \n  save_path &lt;- paste0(\"figures/\", species, \"_\", x_var, \"_vs_\", y_var, \".png\")\n  \n  ggsave(save_path, plot = plot, width = 10, height = 6, units = \"in\")\n}\n\nwalk(valid_species, ~ plot_species(\n  data = surveys,\n  x_var = \"weight\",\n  y_var = \"hindfoot_length\",\n  colour = \"sex\",\n  species = .x \n))"
  },
  {
    "objectID": "02_code.html#writing-better-code",
    "href": "02_code.html#writing-better-code",
    "title": "R Code",
    "section": "",
    "text": "We can improve our scripts by writing code which is:\n\nReadable\n\n\nUse a consistent style guide (like the tidyverse one)\nBe clear, concise, and consistent when naming objects, datasets, and functions\nBreak your scripts up into sections (Ctrl+Shift+R)\n\n\nReusable\n\n\nWrite functions to perform sets of operations\nUse iteration (for loops, or map())\nConsider creating packages for data and code used in multiple places\nBreak up long scripts into separate files (cleaning, manipulating, plotting)\n\n\nDocumented\n\n\nUse comments to explain why you did something the way you did\nInclude a README with each project to provide important context and background\n\nCreate a new script in RStudio (Ctrl+Shift+N) and save it in the scripts folder.\nLoad packages we need for the workshop.\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(purrr)\nlibrary(renv)\n\nLet’s take a common example of some data analysis and apply the above principles when writing the code.\nFirst, let’s read in some data split into different files by month. Instead of naming each file, we can use readr::read_csv() to read them all in at once, bind them together into a single dataframe, and add a new column containing the filename of the data source.\n\nfiles &lt;- list.files(path = \"data_raw\", pattern = \"\\\\.csv\", full.names = TRUE)\n\nsurveys &lt;- read_csv(files, id = \"source\")\n\nThis dataset comprises measurements taken from mammals captured in the Chihuahuan desert.\nLet’s say we wanted to create a separate scatterplot for each species showing hindfoot length vs weight. Even if we’re only interested in species codes with at least 100 valid observations, that’s still 11 plots.\n\nvalid_species &lt;-\n  surveys |&gt;\n  drop_na(all_of(c(\"weight\", \"hindfoot_length\"))) |&gt; \n  count(species_id) |&gt; \n  filter(n &gt;= 100) |&gt; \n  pull(species_id)\n\nRather than write out the same code 15 times, this is a good time to write our own function. If we encapsulate all the plotting steps in a function, we can then use {purrr} to apply the function over the species and create the plots.\n\n# Create an example of a plot\nggplot(surveys, aes(x = weight, y = hindfoot_length, colour = sex)) +\n  geom_point() +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nplot_species &lt;- function(data, x_var, y_var, colour, species) {\n\n  filtered_data &lt;- \n    data |&gt; \n    filter(species_id == {{ species }})\n  \n  plot_title &lt;- paste0(y_var, \" vs. \", x_var, \" for Species ID: \", species)\n  \n  plot &lt;- \n    filtered_data |&gt; \n    ggplot(aes(x = .data[[x_var]], y = .data[[y_var]], colour = .data[[colour]])) +\n    geom_point(alpha = 0.6) +\n    theme_minimal() +\n    ggtitle(plot_title)\n  \n  save_path &lt;- paste0(\"figures/\", species, \"_\", x_var, \"_vs_\", y_var, \".png\")\n  \n  ggsave(save_path, plot = plot, width = 10, height = 6, units = \"in\")\n}\n\nwalk(valid_species, ~ plot_species(\n  data = surveys,\n  x_var = \"weight\",\n  y_var = \"hindfoot_length\",\n  colour = \"sex\",\n  species = .x \n))"
  }
]